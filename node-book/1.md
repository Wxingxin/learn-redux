# express çš„å¼€å§‹

`npm init -y`
`npm install express`
`npm install nodemon`

é…ç½®é¡¹ç›®

```js
//package.json
"scripts": {
    "start": "npx nodemon index.js"
},
```

create ./index.js

```js
const express = require("express");
const app = express();
const PORT = 3000;

app.listen(PORT, () => {
  console.log(`port ${PORT} is run ğŸš€`);
});
```

`npm starat`

æˆ‘ä»¬åˆ›å»ºäº†é¡¹ç›®

# get

### basic get

```js
app.get("/", (req, res) => {
  //æ‰“å°åœ¨æ§åˆ¶å°
  console.log("get /");
  res.send("wo");
});

app.get("/user", (req, res) => {
  //æ‰“å°åœ¨æ§åˆ¶å°
  console.log("get /user");
  res.send("<h1>express get /user</h1>");
});
```

### ä½¿ç”¨ URL æŸ¥è¯¢å‚æ•° (Query Parameters)

```js
//http://localhost:3000/welcome?name=(wei)
app.get("/welcome", (req, res) => {
  //å–â€˜nameâ€™æŸ¥è¯¢å‚æ•°ï¼Œå¦‚æœé»˜è®¤æ¸¸å®¢
  const userName = req.query.name || "æ¸¸å®¢";
  res.send(`Hello ${userName},welcome `);
});
```

```js
// ä¾‹å¦‚:è®¿é—® http://localhost:3000/search?q=(Node.js)&page=(1)
app.get("/search", (req, res) => {
  const queryTerm = req.query.q;
  const pageNumber = req.query.page || 1;
  if (queryTerm) {
    res.send(`ä½ æ­£åœ¨æœç´¢${queryTerm},ç¬¬${pageNumber}é¡µ`);
  } else {
    res.send("è¯·è¾“å…¥æœç´¢å…³é”®");
  }
});
```

### ä½¿ç”¨ URL è·¯å¾„å‚æ•° (Route Parameters)

```js
//http://localhost:3000/users/(1)
app.get("/user/:id", (req, res) => {
  const userId = req.params.id;
  const users = {
    1: { name: "wei", age: 21 },
    2: { name: "gao", age: 22 },
  };
  if (users[userId]) {
    res.json(users[userId]);
  } else {
    res.status(404).send("æœªæ‰¾åˆ°è¯¥ç”¨æˆ·");
  }
});
```

```js
app.get("/products/:category/:item", (req, res) => {
  const category = req.params.category;
  const item = req.params.item;
  res.send(`ä½ æ­£åœ¨æŸ¥çœ‹${category}ç±»åˆ«ä¸‹çš„${item}äº§å“`);
});
```

# post

`express.json()`:
ç”¨äºè§£æ JSON æ ¼å¼çš„è¯·æ±‚ä½“ã€‚å½“å®¢æˆ·ç«¯å‘é€çš„æ•°æ®æ˜¯ `Content-Type: application/json` æ—¶ä½¿ç”¨ã€‚

`express.urlencoded({ extended: true })`:
ç”¨äºè§£æ `URL-encoded` æ ¼å¼çš„è¯·æ±‚ä½“ã€‚å½“å®¢æˆ·ç«¯é€šè¿‡ HTML è¡¨å•ä»¥ `application/x-www-form-urlencoded` æ–¹å¼æäº¤æ•°æ®æ—¶ä½¿ç”¨ã€‚`extended: true` é€‰é¡¹å…è®¸è§£ææ›´å¤æ‚çš„æ•°æ®ç»“æ„ã€‚

```js
const express = require("express");
const app = express();

// --- é‡è¦çš„ä¸­é—´ä»¶ï¼šç”¨äºè§£æè¯·æ±‚ä½“ ---
// è§£æ JSON æ ¼å¼çš„è¯·æ±‚ä½“
app.use(express.json());
// è§£æ URL-encoded æ ¼å¼çš„è¯·æ±‚ä½“ï¼ˆä¾‹å¦‚ HTML è¡¨å•æäº¤ï¼‰
app.use(express.urlencoded({ extended: true }));

// ... å…¶ä»–è·¯ç”±å’Œä¸­é—´ä»¶
```

```js
app.use(express.json());
// è·¯ç”±ï¼šæ¥æ”¶æ–°çš„ç”¨æˆ·æ•°æ®
app.post("/users", (req, res) => {
  const userData = req.body; // è·å–è¯·æ±‚ä½“ä¸­çš„ JSON æ•°æ®

  // 2. å°†æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“æˆ–è¿›è¡Œå…¶ä»–å¤„ç†
  // å‡è®¾è¿™é‡Œå°†ç”¨æˆ·æ•°æ®ä¿å­˜åˆ°å†…å­˜æ•°ç»„ä¸­ä½œä¸ºç¤ºä¾‹
  console.log("æ¥æ”¶åˆ°æ–°çš„ç”¨æˆ·æ•°æ®:", userData);
  const newUser = { id: Date.now(), ...userData }; // ç®€å•ç”Ÿæˆä¸€ä¸ª ID
  // users.push(newUser); // å¦‚æœæœ‰å…¨å±€ç”¨æˆ·æ•°ç»„ï¼Œå¯ä»¥è¿™æ ·æ·»åŠ 

  // 3. è¿”å›å“åº”ï¼Œé€šå¸¸æ˜¯æ–°åˆ›å»ºèµ„æºçš„è¡¨ç¤º
  res.status(201).json({
    message: "ç”¨æˆ·åˆ›å»ºæˆåŠŸï¼",
    user: newUser,
  });
});
```

```js
app.use(express.urlencoded({ extended: true }));
// GET è¯·æ±‚ï¼šæä¾›ä¸€ä¸ªç®€å•çš„ HTML è¡¨å•é¡µé¢
app.get("/form", (req, res) => {
  res.send(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>æäº¤è¡¨å•</title>
    </head>
    <body>
      <h1>æ³¨å†Œ</h1>
      <form action="/register" method="POST">
        <label for="username">ç”¨æˆ·å:</label><br>
        <input type="text" id="username" name="username" required><br><br>
        <label for="password">å¯†ç :</label><br>
        <input type="password" id="password" name="password" required><br><br>
        <input type="submit" value="æ³¨å†Œ">
      </form>
    </body>
    </html>
  `);
});

// è·¯ç”±ï¼šå¤„ç†è¡¨å•æäº¤ï¼ˆPOST è¯·æ±‚ï¼‰
app.post("/register", (req, res) => {
  const formData = req.body; // è·å–è¯·æ±‚ä½“ä¸­çš„è¡¨å•æ•°æ®
  const username = formData.username;
  const password = formData.password;

  res.send(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>æ³¨å†ŒæˆåŠŸ</title>
    </head>
    <body>
      <h2>æ³¨å†ŒæˆåŠŸï¼</h2>
      <p>æ¬¢è¿ ${username}ï¼</p>
      <p>you password ${password}</p>
      <p><a href="/form">è¿”å›æ³¨å†Œé¡µé¢</a></p>
    </body>
    </html>
  `);
});
```

# delete

```js
//http://localhost:3000/users/(1)
//åˆ é™¤ä¸ä¼šçœŸæ­£æ”¹å˜users
let users = [
  { id: "1", name: "å¼ ä¸‰", email: "zhangsan@example.com" },
  { id: "2", name: "æå››", email: "lisi@example.com" },
  { id: "3", name: "ç‹äº”", email: "wangwu@example.com" },
];

app.get("/users", (req, res) => {
  res.status(200).json(users);
});

app.delete("/users/:id", (req, res) => {
  const userId = req.params.id;
  const initialLength = users.length;
  users = users.filter((user) => user.id !== userId);

  if (initialLength > users.length) {
    res.status(200).send(`user ${userId} is delete`);
  } else {
    res.status(404).send({ message: "404 not fonund" });
  }
});
```
